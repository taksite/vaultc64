         *= $1000;---------------------------------------BUFOR    = $0340 ;BUFOR NA 128 BAJTOWBUFORPRG = BUFOR+128 ;BUFOR PROCEDUR                     ;ZAPISU I ODCZYTUPASKI    = $D020REJESTR  = $D100F7       = $F7 ;NR BANKU ZRODLOWEGOF8       = $F8 ;ILOSC BLOKOW 128BAJT               ;DO PRZESLANIAF9       = $F9 ;WEKTOR ADR.ZRODLOWEGOFA       = $FAFB       = $FB ;NR BANKU DOCELOWEGOFC       = $FC ;WEKTOR ADR. DOCELOWEGOFD       = $FDFE       = $FE;ZNACZNIK ZAPISU DO ATMEL              ;0 = NIE              ;1 = TAK;---------------------------------------;PRZYKLADOWE UST. DO TESTOW;BANKZ    = $01   ;BANK ZRODLOWYADRZ     = $C000 ;ADR. ZRODLOWYILBLOK   = $03   ;ILOSC BLOKOWBANKD    = $04ADRD     = $C000;---------------------------------------;PROCEDURA DO TESTOW         JSR INITREJESTR         LDY #>ADRZ         LDA #<ADRZ         LDX #BANKZ         JSR OPENSOUL         LDY #>ADRD         LDA #<ADRD         LDX #BANKD         JSR OPENDEST         SEI         LDA #ILBLOK         JSR RELOKATOR         CLI         RTS;---------------------------------------         JMP RELOKATOR         JMP WAIT         JMP GOWPFLASH         JMP GOZAPIS         JMP GOODCZYT         JMP ODCZYT         JMP OPENSOUL         JMP OPENDEST;---------------------------------------RELOKATOR         STA F8RE0         JSR GOODCZYT         JSR BUFORPRG         LDA FE        ;JESLI ATMEL         BEQ RE1       ;TO WL. ZAPIS         JSR GOWPFLASH         JSR BUFORPRGRE1         JSR GOZAPIS         JSR BUFORPRG         LDA FE         BEQ RE2         JSR WAITRE2         DEC F8         LDA F8         BEQ EXITRE         LDA F9         CLC         ADC #128         STA F9         LDA FA         ADC #0         STA FA         LDA FC         CLC         ADC #128         STA FC         LDA FD         ADC #0         STA FD         JMP RE0EXITRE         RTS;---------------------------------------;USTAWIA REJESTR $D100 NA ONINITREJESTR         LDA $01         PHA         LDA #$37         STA $01         LDA #$FF         STA REJESTR+2         LDA #$C0         STA REJESTR         PLA         STA $01         RTS;---------------------------------------OPENDEST         STY FD         STA FC         LDA TABELA,X         STA FB         AND #%00000111         CMP #$07 ; SPR. CZY TO ATMEL         BNE OPDE1         LDA #1OPDE2         STA FE         RTSOPDE1         LDA #0         BEQ OPDE2OPENSOUL         STA F9         STY FA         LDA TABELA,X         STA F7         RTSTABELA         .BYTE $0C,$00,$01,$02,$03,$04         .BYTE $05,$06,$07,$17,$27,$37;---------------------------------------WAIT         LDX #$C8WAIT1         NOP         JMP *+3         JMP *+3         JMP *+3         JMP *+3         JMP *+3         JMP *+3         JMP *+3         JMP *+3         DEX         BNE WAIT1         RTS;---------------------------------------GOWPFLASH         LDX #0GOTR3         LDA ODCZYT+$6C,X         STA BUFORPRG,X         INX         CPX #$36         BNE GOTR3         RTS;---------------------------------------GOZAPIS         LDX #0GOTR2         LDA ODCZYT+$36,X         STA BUFORPRG,X         INX         CPX #$36         BNE GOTR2         RTS;---------------------------------------GOODCZYT         LDX #0GOTR1         LDA ODCZYT$X         STA BUFORPRG,X         INX         CPX #$36         BNE GOTR1PROCEDURY RTS;---------------------------------------;USTALENIE PRACY DLA PROCEDURY;ODCZYTODCZYT         *= $03C0         .OFFS PROCEDURY+1-$03C0;---------------------------------------         LDA $01         STA ZAP1+1 ;ZAPIS KONF.         LDA #$37         STA $01         LDA REJESTR         STA ZAP2+1         LDA F7         STA REJESTR         INC $01 ;WYL. ROM         LDY #0ODC1         LDA (F9),Y         DEC $01         STA PASKI         INC $01         STA BUFOR,Y         INY         CPY #128         BNE ODC1         DEC $01ZAP2     LDA #0         STA REJESTRZAP1     LDA #0         STA $01         RTS;-----%---------------------------------         *= $03C0         .OFFS PROCEDURY+1-$03C0+$36ZAPIS         LDA $01         STA ZAP3+1         LDA #$37         STA $01         LDA REJESTR         STA ZAP4+1         LDA FB         STA REJESTR         INC $01         LDY #0ZPS1         LDA BUFOR,Y         DEC $01         STA $D020         INC $01         STA (FC),Y         INY         CPX #128         BNE ZPS1         DEC $01ZAP4     LDA #0         STA REJESTRZAP3     LDA #0         STA $01         RTS;---------------------------------------         *= $03C0         .OFFS PROCEDURY+1-$03C0+$6CWPFLASH2         LDA $01         STA WPF1+1         LDA #$37         STA $01         LDA REJESTR         STA WPF2+1         LDA #$07   ;WL.1 BANKU ATMELA         STA REJESTR         INC $01         LDA #$AA         STA $D555         LDA #$55         STA $AAAA         LDA #$A0         STA $D555         DEC $01WPF2     LDA #0         STA REJESTRWPF1     LDA #0         STA $01         RTS