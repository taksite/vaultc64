;---------------------------------------;√œÕÕœƒœ“≈ & ¡Õ…«¡ 4/1995 S.38;TURBOLOADER 1541 ……;FULL CONTROL SYSTEM;(C) BY «.◊EGNER;---------------------------------------;PROGRAM TEN LADUJE PLIKI NIERELOKOWALNE;PRZESTRZEN ADRESOWA DLA PLIKU;$0801-$FFFF.;–ROCEDURA INICJUJACA:;        *=$6000         LDA #8         TAX         TAY     ;W Ÿ <> 0 !SETLFS   JSR $FFBA         LDA #6         LDX #<NAME         LDY #>NAMESETNAM   JSR $FFBD         JMP TURBONAME     .TEXT "SUPER*"  ;PRZYKLADOWO !;---------------------------------------         *= $5000TURBO    SEI         LDA #$37         STA 1       ; JSR $FDA3       ; JSR $E453         JSR $E544         LDA #0         STA $90         STA $D015OPEN     JSR LISTEN         LDA $90         BPL OPEN2         SEC        ;NIE MA STACJI!         RTSOPEN2    LDA #"I"         JSR $FFA8         JSR $FFAE         JSR $F5B3  ;SEARCHING FOR:         JSR $F3DD  ;OTWARCIE ZBIORU                    ;NA …≈√         JSR $F642  ;ZAMKNIECIE ZBIORU         JSR STATUS         BCC MEW         RTS        ;BLAD W STATUSIE;---------------------------------------LISTEN   LDA $BA         JSR $FFB1         ;---------SECOND   LDA #$6F         JMP $FF93;---------------------------------------MEW         LDA #<PROG+1 ;MEM-WRITE         STA LOOP1+1         LDA #>PROG+1         STA LOOP1+2         LDY #$49         JSR $F5DA    ;LOADDING         LDX #0LOOP     JSR LISTENDALEJ    LDA #$4D         JSR $FFA8         LDA #$2D         JSR $FFA8         LDA #$57         JSR $FFA8MEW3     LDA #0         JSR $FFA8MEW4     LDA #4         JSR $FFA8         LDA #$20         TAY         JSR $FFA8LOOP1    LDA $1000,X         JSR $FFA8         INX         STX MEW3+1         BEQ MEW6MEW5     DEY         BNE LOOP1         JSR $FFAE         JMP LOOPMEW6     JSR $FFAE         JSR LISTENMEX      LDA T1,X     ;MEM-EXECUTE         JSR $FFA8         INX         CPX #5         BNE MEX         LDX #$95RELOKUJ  LDA LOADING-1,X         STA $0333,X         DEX         BNE RELOKUJ         JSR $FFAE         SEI         JSR INITLINE         JMP $0334;---------------------------------------T1       .TEXT "M-E"         .BYTE 3,4;---------------------------------------LOADING  BIT $DD00         BVS *-3         LDY #0         JSR $034E     ;<LOADADRES         STA $2B         STA $2D         JSR $034E         STA $2C         STA $2E       ;>LOADADRES         LDA #$E6         STA $0383POB      BIT $DD00         BVC *-3         SECRASTER   LDA $D012         SBC #$32         BCC POB2         AND #7         BEQ RASTERPOB2     LDA #3         STA $DD00;---------------------------------------         BIT $DD00         BPL STATUS  ;CZY JUZ KONIEC?         NOPINITLINE LDX #$23;---------------------------------------         LDA $DD00         LSR A         LSR A         EOR $DD00         LSR A         LSR A         EOR $DD00         LSR A         LSR A         EOR $DD00         STX $DD00         EOR #$03ZMIANA   RTS         .BYTE 1ADY      STA ($2D),Y         DEC 1         STX $D020         INC $2D         STY $D020         BNE POB         INC $2E         BNE POB         BEQ PROG2;---------------------------------------STATUS   LDA #13         JSR $FFD2         LDA $BA         JSR $FFB4         LDA #$6F         JSR $FF96         JSR $FFA5         TAY         JSR $FFD2ACPTR    JSR $FFA5         JSR $FFD2         CMP #13         BNE ACPTR         JSR $FFAB         CPY #$30         BNE PROG1PROG2    LDA #$03         STA $DD00         CLC         RTSPROG1    SECPROG     RTS;---------------------------------------;--------  DRIVE CODE ! ----------------;---------------------------------------         *= $0400         .OFFS PROG+1-$0400COUNTER  = $85         JMP IRQSTART    LDA #$7A         STA $1802         LDA #$08         STA $1800         LDA #$10         STA $1C07         LDA #5         STA $6A ;ZOB. RAM DRIVE         LDA $18 ;PO OTWARCIU ZBIORU         STA $08 ;W $18 I $19 MAMY         LDA $19 ;START TRACK I SECTOR         STA $09         LDX #$38COPYROM  LDA $F4D1,X         STA $0150,X         DEX         BPL COPYROM         LDA #$60 ;RTS BEZ IRQEXIT         STA $0184CONT     LDY #5   ;LICZNIK BLENDOWCONT2    LDA #$E0 ;NASZ KOD ROBOCZYROM      LDX #1   ;NR BUFORA -$0400         STA $0298;W RAZIE BLEDU NIE                  ;UZYWAC KODU '$C0'         JSR $D57D;OBSLUGA STEROWANIA         JSR $D599;GLOWICY PRZEZ ƒœ”         CMP #$02         BCC NEXTTRAC         DEY         BNE CONT2         JSR INITVIAERROR    JMP $E60ANEXTTRAC LDA 8     ;ENDSECTOR?         BNE CONT;---------------------------------------INITVIA  LDY #$1A         STY $1802         LDY #$3A         STY $1C07         LDY #$02  ;≈œ∆         STY $1800 ;END OF FILE         RTS;---------------------------------------IRQ      LDA #3    ;CZYTAC BLOK DO         STA $31   ;BUFORA $0300         LDA 8     ;TRACK         STA 6IRQ2     LDA 9     ;SECTOR         STA 7         JSR $0150 ;READ         LDX $0301 ;LINK INFO         LDA $0300 ;OSTATNI SECTOR?         STA 8         BNE IRQ3         INX       ;ILE BAJTOW DO         STX ILE+1 ;TRANSMISJIIRQ3     STX 9     ;ALBO NR NEXTSEC.         LDY #$02         STY COUNTERTRANSMIT LDA $0300,Y         TAY         AND #$0F         TAX         TYA         LSR A         LSR A         LSR A         LSR A         TAY         LDA #0         STA $1800         LDA TABKONW,X         LDX $1800         BNE *-3         STA $1800         ASL A         AND #$0F         STA $1800         LDA TABKONW,Y         STA $1800         ASL A         AND #$0F         STA $1800         LDA #8         INC COUNTER         STA $1800         LDY COUNTERILE      CPY #0         BNE TRANSMIT         EOR $1C00         STA $1C00         LDA 8 ;CZY TEN SAM TRACK?         CMP $22         BEQ IRQ2IRQEXIT  JMP $F505;---------------------------------------TABKONW  .BYTE $0F,$07,$0D,$05,$0B,$03         .BYTE $09,$01         .BYTE $0E,$06,$0C,$04,$0A,$02         .BYTE $08,$00;---------------------------------------;        RAM DRIVE;---------------------------------------         ;$006A         ;BITY 0-5 ILOSC PROB ODCZYTU         ;         PRZY BLEDZIE         ;     6 ->0 URUCHAMIAC         ;           HALFTRACK         ;       ->1 NIE URUCHAMIAC         ;     7 ->0 URUCHAMIAC TRACK0         ;       ->1 BEZ TRACK0;---------------------------------------         ;$298         ;         ;BIT 7->1 NA OKRES JEDNEJ         ;         OBSLUGI KODU ROBO-         ;         CZEGO NIE UZYWAC         ;         TRACK0 /KODU $C0/;---------------------------------------